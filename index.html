<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="theme-color" content="#000000" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>WorldMe - Social Map & Party Discovery</title>
    <meta name="description" content="Meet friends through animated avatars, discover epic parties nearby, and create unforgettable memories on the social map. Join WorldMe today!" />
    <meta name="author" content="WorldMe" />

    <meta property="og:title" content="WorldMe - Social Map & Party Discovery" />
    <meta property="og:description" content="Meet friends through animated avatars, discover epic parties nearby, and create unforgettable memories on the social map. Join WorldMe today!" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@WorldMeApp" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    
    <!-- Critical inline CSS for fast first paint -->
    <style>
      /* Critical CSS variables for immediate availability */
      :root {
        --background: 240 10% 3.9%;
        --foreground: 0 0% 98%;
        --card: 240 10% 3.9%;
        --card-foreground: 0 0% 98%;
        --primary: 270 95% 65%;
        --primary-foreground: 0 0% 98%;
        --primary-glow: 280 100% 75%;
        --secondary: 210 100% 70%;
        --secondary-foreground: 0 0% 98%;
        --party-pink: 320 100% 70%;
        --party-orange: 30 100% 60%;
        --event-purple: 270 95% 65%;
        --friend-green: 150 80% 55%;
        --muted: 240 3.7% 15.9%;
        --muted-foreground: 240 5% 64.9%;
        --accent: 320 100% 70%;
        --accent-foreground: 0 0% 98%;
        --destructive: 0 84.2% 60.2%;
        --destructive-foreground: 0 0% 98%;
        --border: 240 3.7% 15.9%;
        --input: 240 3.7% 15.9%;
        --ring: 270 95% 65%;
        --radius: 0.5rem;
        
        /* Critical gradients */
        --gradient-party: linear-gradient(135deg, hsl(var(--primary)), hsl(var(--party-pink)), hsl(var(--party-orange)));
        --gradient-event: linear-gradient(135deg, hsl(var(--event-purple)), hsl(var(--secondary)));
        --gradient-social: linear-gradient(135deg, hsl(var(--friend-green)), hsl(var(--secondary)));
        --shadow-party: 0 20px 40px -10px hsl(var(--primary) / 0.4);
      }
      
      /* Critical layout styles */
      *, *::before, *::after {
        box-sizing: border-box;
        border-color: hsl(var(--border));
      }
      
      body {
        background-color: hsl(var(--background));
        color: hsl(var(--foreground));
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        line-height: 1.5;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
        overflow: hidden;
        position: fixed;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
      
      html {
        height: 100%;
        height: 100vh;
        height: 100dvh;
      }
      
      #root {
        height: 100%;
        height: 100vh;
        height: 100dvh;
        display: flex;
        flex-direction: column;
      }
      
      /* Critical button styles */
      .btn-primary {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        white-space: nowrap;
        border-radius: calc(var(--radius) - 2px);
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.3s ease;
        background: var(--gradient-party);
        color: hsl(var(--primary-foreground));
        border: none;
        padding: 0.75rem 1.5rem;
        cursor: pointer;
        text-decoration: none;
        box-shadow: var(--shadow-party);
      }
      
      .btn-primary:hover {
        transform: scale(1.05);
        box-shadow: 0 25px 50px -10px hsl(var(--primary) / 0.6);
      }
      
      /* Critical text styles */
      .text-5xl { font-size: 3rem; line-height: 1; }
      .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
      .font-black { font-weight: 900; }
      .text-center { text-align: center; }
      .leading-tight { line-height: 1.25; }
      .leading-relaxed { line-height: 1.625; }
      .mb-6 { margin-bottom: 1.5rem; }
      .mb-8 { margin-bottom: 2rem; }
      .max-w-2xl { max-width: 42rem; }
      .max-w-4xl { max-width: 56rem; }
      .mx-auto { margin-left: auto; margin-right: auto; }
      .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
      
      /* Critical layout utilities */
      .relative { position: relative; }
      .absolute { position: absolute; }
      .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
      .z-0 { z-index: 0; }
      .z-10 { z-index: 10; }
      .z-20 { z-index: 20; }
      .flex { display: flex; }
      .flex-col { flex-direction: column; }
      .items-center { align-items: center; }
      .justify-center { justify-content: center; }
      .min-h-screen { min-height: 100vh; }
      .w-full { width: 100%; }
      .h-full { height: 100%; }
      .object-cover { object-fit: cover; }
      .overflow-hidden { overflow: hidden; }
      
      /* Critical gradient utilities */
      .gradient-party {
        background: var(--gradient-party);
        -webkit-background-clip: text;
        background-clip: text;
      }
      
      .bg-clip-text {
        -webkit-background-clip: text;
        background-clip: text;
      }
      
      .text-transparent {
        color: transparent;
      }
      
      .text-muted-foreground {
        color: hsl(var(--muted-foreground));
      }
      
      .text-foreground {
        color: hsl(var(--foreground));
      }
      
      /* Loading spinner for immediate display */
      .loading-spinner {
        width: 4rem;
        height: 4rem;
        border: 4px solid hsl(var(--muted));
        border-top: 4px solid hsl(var(--primary));
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      /* Prevent zoom on input focus */
      input[type="text"], input[type="email"], input[type="password"], textarea {
        font-size: 16px !important;
      }
      
      /* Mobile-specific safe areas */
      .safe-area-inset-bottom {
        padding-bottom: env(safe-area-inset-bottom);
      }
      
      .safe-area-inset-top {
        padding-top: env(safe-area-inset-top);
      }
      
      /* Better touch targets for mobile */
      button, .clickable {
        min-height: 44px;
        min-width: 44px;
      }
      
      /* Prevent overscroll bounce on iOS */
      html, body {
        overscroll-behavior: none;
      }
      
      /* Hide scrollbars on mobile */
      ::-webkit-scrollbar {
        width: 0px;
        background: transparent;
      }
      
      /* Media queries for responsive text */
      @media (min-width: 768px) {
        .text-5xl { font-size: 4.5rem; }
        .text-xl { font-size: 1.5rem; line-height: 2rem; }
      }
      
      @media (min-width: 1024px) {
        .text-5xl { font-size: 4.5rem; }
      }
    </style>
    
    <!-- Resource hints for performance optimization -->
    <link rel="preconnect" href="https://api.mapbox.com" crossorigin>
    <link rel="preconnect" href="https://events.mapbox.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="dns-prefetch" href="//cdn.supabase.com">
    <link rel="dns-prefetch" href="//models.readyplayer.me">
    <link rel="dns-prefetch" href="//render.readyplayer.me">
    
    <!-- Preload critical Mapbox resources and optimized hero image -->
    <link rel="preload" href="https://api.mapbox.com/mapbox-gl-js/v3.15.0/mapbox-gl.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://api.mapbox.com/fonts/mapbox" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/src/assets/hero-party-optimized.jpg" as="image" fetchpriority="high">
    
    <!-- Preload critical JavaScript modules with optimized scheduling -->
    <link rel="modulepreload" href="/src/main.tsx">
    <link rel="modulepreload" href="/src/App.tsx">
    <link rel="modulepreload" href="/src/pages/MainApp.tsx">
    <!-- Defer heavy 3D and map components to reduce main thread blocking -->
    <link rel="prefetch" href="/src/components/RealMapComponent.tsx">
    <link rel="prefetch" href="/src/components/HeroSection.tsx">
    <link rel="prefetch" href="/src/components/AvatarDisplay.tsx">
    <link rel="prefetch" href="/src/components/Avatar3D.tsx">
    
    <!-- Defer loading of non-critical resources with main-thread optimization -->
    <script>
      // Optimized script scheduling to minimize main-thread blocking
      const deferHeavyOperations = () => {
        // Use scheduler API safely with proper context binding
        const schedule = (callback, options = {}) => {
          if (window.scheduler && window.scheduler.postTask) {
            try {
              return window.scheduler.postTask.call(window.scheduler, callback, options);
            } catch (e) {
              // Fallback if scheduler fails
              return setTimeout(callback, options.delay || 0);
            }
          }
          return setTimeout(callback, options.delay || 0);
        };
        
        // Load CSS with minimal main-thread impact
        const loadCSS = (href, media = 'all') => {
          return schedule(() => {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = href;
            link.media = media;
            
            if (media !== 'all') {
              link.onload = function() {
                this.media = 'all';
                this.onload = null;
              };
            }
            
            document.head.appendChild(link);
          });
        };
        
        // Progressive CSS loading to reduce main-thread work
        loadCSS('/src/index.css', 'print');
        
        // Defer CSS activation to avoid layout thrashing
        schedule(() => {
          const cssLink = document.querySelector('link[href="/src/index.css"]');
          if (cssLink && cssLink.media === 'print') {
            cssLink.media = 'all';
          }
        }, { delay: 50 });
        
        // Pre-warm heavy libraries in idle time
        if (window.requestIdleCallback) {
          requestIdleCallback(() => {
            // Optional: Could pre-warm other heavy modules here
            console.log('Browser idle time available for optimizations');
          }, { timeout: 2000 });
        }
      };
      
      // Use optimal timing for script execution
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          // Use requestAnimationFrame to ensure DOM is ready
          requestAnimationFrame(deferHeavyOperations);
        });
      } else {
        // Page already loaded, defer to next tick
        if (window.requestIdleCallback) {
          requestIdleCallback(deferHeavyOperations, { timeout: 100 });
        } else {
          setTimeout(deferHeavyOperations, 1);
        }
      }
    </script>
    
    <!-- Main script with defer for non-blocking load -->
    <script type="module" src="/src/main.tsx" defer></script>
  </head>

  <body>
    <div id="root">
      <!-- Minimal loading state to prevent layout shift -->
      <div style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: hsl(240 10% 3.9%); color: hsl(0 0% 98%);">
        <div style="text-align: center;">
          <div class="loading-spinner"></div>
          <div style="font-size: 1.125rem; font-weight: 600;">Loading WorldMe...</div>
          <div style="font-size: 0.875rem; opacity: 0.8; margin-top: 0.5rem;">Preparing your social world</div>
        </div>
      </div>
    </div>
  </body>
</html>
